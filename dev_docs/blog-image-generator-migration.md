# Blog Image Generator - Migration Guide

This guide explains how to remove the image generation system from this app and use the standalone package in your blog service instead.

## Overview

The image generation system has been extracted into a standalone package at `packages/blog-image-generator/`. This package can be:

1. Used directly in your blog service
2. Published as an npm package
3. Copied to your blog service repository

## What to Remove from This App

### Files to Remove

1. **Image Generation Library**

   - `src/lib/blog/generate-image.ts` - Remove this file

2. **API Route** (optional - can keep for fallback)

   - `src/app/api/blog/generate-image/route.ts` - Remove if not needed

3. **Script** (optional)
   - `scripts/generate-blog-images.js` - Remove if not needed

### Files to Update

1. **Blog Types** (`src/lib/blog/types.ts`)

   - Remove import: `import type { ImageStatus, ImageComplexity } from "./generate-image";`
   - Keep the fields in `BlogPostMetadata` if you want to track status:
     ```typescript
     imageStatus?: "pending" | "generating" | "complete" | "failed";
     imageTheme?: string;
     imageComplexity?: "simple" | "medium" | "complex";
     ```
   - Or remove these fields entirely if not needed

2. **Cache Generation Script** (`scripts/generate-blog-cache.js`)
   - Remove image generation logic from `triggerImageGeneration()` function
   - Simplify to just check if image exists:
     ```javascript
     function triggerImageGeneration(metadata, content) {
       const imagePath = `/blog/images/${metadata.slug}.jpg`;
       const imageExists = checkImageExists(imagePath);

       if (imageExists) {
         return { imagePath, status: "complete" };
       }

       // Image will be generated by blog service
       return { imagePath, status: "pending" };
     }
     ```

## Using the Standalone Package

### Option 1: Copy Package to Blog Service

1. Copy `packages/blog-image-generator/` to your blog service
2. Install dependencies:
   ```bash
   cd packages/blog-image-generator
   npm install
   npm run build
   ```
3. Use in your blog service (see README in package)

### Option 2: Publish as npm Package

1. Build the package:

   ```bash
   cd packages/blog-image-generator
   npm run build
   ```

2. Publish to npm (or private registry):

   ```bash
   npm publish
   ```

3. Install in blog service:
   ```bash
   npm install @chatiq/blog-image-generator
   ```

### Option 3: Use as Git Submodule

1. Extract to separate repository
2. Add as git submodule in blog service:
   ```bash
   git submodule add <repo-url> packages/blog-image-generator
   ```

## Integration Example

### In Your Blog Service

```typescript
// When creating a new blog post
import { generateBlogImage, getWordCount } from "@chatiq/blog-image-generator";

async function createPost(postData: BlogPost) {
  // 1. Create MDX file
  await saveMDXFile(postData);

  // 2. Generate image
  const imageResult = await generateBlogImage({
    slug: postData.slug,
    title: postData.title,
    description: postData.description,
    categories: postData.categories,
    tags: postData.tags,
    wordCount: getWordCount(postData.content),
    openaiApiKey: process.env.OPENAI_API_KEY!,
    outputDir: path.join(process.cwd(), "public/blog/images"),
  });

  // 3. Update MDX metadata with image path
  const imagePath = `/blog/images/${imageResult.imagePath}`;
  await updateMDXMetadata(postData.slug, { image: imagePath });

  return { ...postData, image: imagePath };
}
```

## Workflow

### Recommended Flow

1. **Blog Service** creates MDX file → generates image → saves image to `public/blog/images/`
2. **This App** reads MDX files → displays blog posts (images already exist)

### Alternative Flow (if keeping API route)

1. **Blog Service** creates MDX file → calls this app's API → image generated here
2. **This App** generates image → saves to `public/blog/images/`

## Checklist

- [ ] Copy `packages/blog-image-generator/` to blog service
- [ ] Install dependencies in blog service
- [ ] Integrate image generation into blog post creation flow
- [ ] Remove `src/lib/blog/generate-image.ts` from this app
- [ ] Update `src/lib/blog/types.ts` (remove or keep image fields)
- [ ] Update `scripts/generate-blog-cache.js` (simplify image logic)
- [ ] Remove `src/app/api/blog/generate-image/route.ts` (optional)
- [ ] Test image generation in blog service
- [ ] Test blog display in this app (images should already exist)

## Notes

- Images are saved to `public/blog/images/{slug}.jpg`
- Placeholder image is created automatically if generation fails
- The package is completely standalone - no dependencies on this app
- OpenAI API key must be provided (via env var or parameter)
